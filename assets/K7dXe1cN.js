import{c as O,u as $,_ as U,a as V,b as j}from"./Cd97SnAP.js";import{_ as K}from"./BoVWbLOk.js";import{n as D,r as p,o as y,u as k,x as r,_ as R,z as Q,s as W,q as z,g as J,A as M,w as c,v as Y,a as b,d as v,b as w,t as G,c as X,B as Z,F as ee}from"./B6piiSkG.js";import{u as te}from"./BaYGabzq.js";const oe=D({__name:"UIOtpInput",props:{value:{},tabindex:{},autofocus:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},setup(A){const l=p({autocomplete:"one-time-code",type:"text",placeholder:"-",pattern:"^\\d$",inputmode:"numeric"});return(u,d)=>{const i=O;return y(),k(i,{class:"otp-input","model-value":u.value,setup:r(l),tabindex:u.tabindex,autofocus:u.autofocus,required:u.required},null,8,["model-value","setup","tabindex","autofocus","required"])}}}),ne=R(oe,[["__scopeId","data-v-8b0344db"]]),se=()=>{const l=p(Array.from({length:6}).fill(null));p(!1);const u=e=>{const{nextElementSibling:o,previousElementSibling:n}=e.closest(".opt-body__input");return{nextEl:o==null?void 0:o.querySelector("input"),prevEl:n==null?void 0:n.querySelector("input"),currentEl:e}},d=e=>new RegExp("^\\d{6}$","gi").test(e),i=e=>{l.value=e.split("")},S=(e,o)=>{console.log(e)},x=({target:e,inputType:o,data:n},s)=>{event.preventDefault();const{currentEl:a,nextEl:t,prevEl:_}=u(e);if(console.log(a,t,_),o==="insertText"){if(d(n)){i(n);return}else if(!/^\d$/gi.test(n))return;const g=a.selectionStart;a.value&&t&&g===1?l.value[s+1]=n:(!a.value||g===0)&&(l.value[s]=n),t==null||t.focus(),t!=null&&t.value&&g===0&&t.setSelectionRange(0,0)}else o==="insertFromPaste"&&d(n)?i(n):o==="deleteContentBackward"?(!a.value||a.selectionStart===0)&&_?_.focus():l.value[s]=null:o==="deleteContentForward"&&((!a.value||a.selectionStart===1)&&t?t.focus():l.value[s]=null)},B=({code:e,target:o},n)=>{const{currentEl:s,nextEl:a,prevEl:t}=u(o);(e==="ArrowLeft"||e==="ArrowRight")&&(event.preventDefault(),e==="ArrowLeft"?t&&(s.selectionStart===0||!s.value)?t.focus():s.setSelectionRange(0,0):e==="ArrowRight"&&(a&&(s.selectionStart===1||!s.value)?a.focus():s.setSelectionRange(1,1)))},f=p(null),L=()=>{f.value&&f.value.abort("error"),f.value=new AbortController,navigator.credentials.get({otp:{transport:["sms"]},signal:f.value.signal}).then(({code:e})=>{i(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("finale")})};return Q(()=>{L()}),{codeLength:6,digitsList:l,pastHandler:S,beforeInputHandler:x,keyDownHandler:B,checkCodeValidity:d}},ae=""+new URL("otp-image.BlQNDQJN.svg",import.meta.url).href,re=["src"],le={class:"form-header"},ce={class:"form-header__main-section"},ue={href:"mailto:johndoe@gmail.com",class:"form-header__link"},ie={class:"opt-body"},_e=D({__name:"otp",setup(A){const l=$(),{email:u,username:d,password:i}=W(l),{clearPasswords:S}=l,{auth:x}=te(),{beforeInputHandler:B,keyDownHandler:f,pastHandler:L,codeLength:e,digitsList:o,checkCodeValidity:n}=se(),s=z(()=>!n(o.value.join(""))),a=p("otp"),t=p(""),_=p(!1);J(o,()=>{t.value=""},{deep:!0});const g=async()=>{const I={password:i.value,username:d.value};try{_.value=!0,await x.login(I)}catch{t.value="Такого пользователя нет"}finally{_.value=!1}};return M((I,C)=>{S()}),(I,C)=>{const q=U,F=K,N=ne,T=V,H=j,P=Y;return y(),k(P,{name:"default"},{image:c(()=>[b("img",{src:r(ae),alt:"create content otp"},null,8,re)]),captionTitle:c(()=>[v(" It's just OTP verification ")]),captionDescription:c(()=>[v(" You are one step away from recovering your password. ")]),form:c(()=>[w(H,{name:r(a),"is-wide":!0,error:r(t)},{header:c(()=>[b("div",le,[w(q,{class:"form-header__title"},{default:c(()=>[v("Enter OTP")]),_:1}),b("p",ce,[v(" Sent OTP on "),b("a",ue,G(r(u)),1)]),w(F,{class:"form-header__link form-header__change-email",to:"/registration",tabindex:"1"},{default:c(()=>[v("Change email")]),_:1})])]),body:c(()=>[b("div",ie,[(y(!0),X(ee,null,Z(r(o),(E,m)=>(y(),k(N,{key:m,value:E,class:"opt-body__input",tabindex:m+2,autofocus:!m,onPast:h=>r(L)(h,m),onBeforeinput:h=>r(B)(h,m),onKeydown:h=>r(f)(h,m)},null,8,["value","tabindex","autofocus","onPast","onBeforeinput","onKeydown"]))),128))])]),button:c(()=>[w(T,{tabindex:r(e)+2,disabled:r(s)||r(_),onAction:g},{default:c(()=>[v("Submit")]),_:1},8,["tabindex","disabled"])]),_:1},8,["name","error"])]),_:1})}}}),ve=R(_e,[["__scopeId","data-v-116efc4c"]]);export{ve as default};
