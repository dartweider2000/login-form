import{c as U,u as V,_ as j,a as K,b as Q}from"./B9oSj2nK.js";import{_ as W}from"./CYKGVqpH.js";import{n as D,r as d,o as y,u as A,x as r,_ as R,z,s as J,A as M,q as Y,g as G,B as X,w as u,C as Z,v as ee,a as b,d as v,b as w,t as te,c as oe,D as ne,F as se}from"./p5JiRb0g.js";import{u as ae}from"./DSxK9u-P.js";const re=D({__name:"UIOtpInput",props:{value:{},tabindex:{},autofocus:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},setup(C){const l=d({autocomplete:"one-time-code",type:"text",placeholder:"-",pattern:"^\\d$",inputmode:"numeric"});return(c,_)=>{const i=U;return y(),A(i,{class:"otp-input","model-value":c.value,setup:r(l),tabindex:c.tabindex,autofocus:c.autofocus,required:c.required},null,8,["model-value","setup","tabindex","autofocus","required"])}}}),le=R(re,[["__scopeId","data-v-8b0344db"]]),ce=()=>{const l=d(Array.from({length:6}).fill(null));d(!1);const c=e=>{const{nextElementSibling:s,previousElementSibling:n}=e.closest(".opt-body__input");return{nextEl:s==null?void 0:s.querySelector("input"),prevEl:n==null?void 0:n.querySelector("input"),currentEl:e}},_=e=>new RegExp("^\\d{6}$","gi").test(e),i=e=>{l.value=e.split("")},x=(e,s)=>{console.log(e)},S=({target:e,inputType:s,data:n},o)=>{event.preventDefault();const{currentEl:a,nextEl:t,prevEl:g}=c(e);if(console.log(a,t,g),s==="insertText"){if(_(n)){i(n);return}else if(!/^\d$/gi.test(n))return;const p=a.selectionStart;a.value&&t&&p===1?l.value[o+1]=n:(!a.value||p===0)&&(l.value[o]=n),t==null||t.focus(),t!=null&&t.value&&p===0&&t.setSelectionRange(0,0)}else s==="insertFromPaste"&&_(n)?i(n):s==="deleteContentBackward"?(!a.value||a.selectionStart===0)&&g?g.focus():l.value[o]=null:s==="deleteContentForward"&&((!a.value||a.selectionStart===1)&&t?t.focus():l.value[o]=null)},B=({code:e,target:s},n)=>{const{currentEl:o,nextEl:a,prevEl:t}=c(s);(e==="ArrowLeft"||e==="ArrowRight")&&(event.preventDefault(),e==="ArrowLeft"?t&&(o.selectionStart===0||!o.value)?t.focus():o.setSelectionRange(0,0):e==="ArrowRight"&&(a&&(o.selectionStart===1||!o.value)?a.focus():o.setSelectionRange(1,1)))},f=d(null),L=()=>{f.value&&f.value.abort("error"),f.value=new AbortController,navigator.credentials.get({otp:{transport:["sms"]},signal:f.value.signal}).then(({code:e})=>{i(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("finale")})};return z(()=>{L()}),{codeLength:6,digitsList:l,pastHandler:x,beforeInputHandler:S,keyDownHandler:B,checkCodeValidity:_}},ue=""+new URL("otp-image.BlQNDQJN.svg",import.meta.url).href,ie=["src"],_e={class:"form-header"},pe={class:"form-header__main-section"},de={href:"mailto:johndoe@gmail.com",class:"form-header__link"},fe={class:"opt-body"},me=D({__name:"otp",async setup(C){let l,c;const _=V(),{email:i,username:x,password:S}=J(_),{clearPasswords:B}=_,{auth:f}=ae();i.value||([l,c]=M(()=>Z("/")),await l,c());const{beforeInputHandler:L,keyDownHandler:e,pastHandler:s,codeLength:n,digitsList:o,checkCodeValidity:a}=ce(),t=Y(()=>!a(o.value.join(""))),g=d("otp"),p=d(""),I=d(!1);G(o,()=>{p.value=""},{deep:!0});const T=async()=>{const k={password:S.value,username:x.value};try{I.value=!0,await f.login(k)}catch{p.value="Такого пользователя нет"}finally{I.value=!1}};return X((k,q)=>{B()}),(k,q)=>{const F=j,N=W,H=le,P=K,E=Q,O=ee;return y(),A(O,{name:"default"},{image:u(()=>[b("img",{src:r(ue),alt:"create content otp"},null,8,ie)]),captionTitle:u(()=>[v(" It's just OTP verification ")]),captionDescription:u(()=>[v(" You are one step away from recovering your password. ")]),form:u(()=>[w(E,{name:r(g),"is-wide":!0,error:r(p)},{header:u(()=>[b("div",_e,[w(F,{class:"form-header__title"},{default:u(()=>[v("Enter OTP")]),_:1}),b("p",pe,[v(" Sent OTP on "),b("a",de,te(r(i)),1)]),w(N,{class:"form-header__link form-header__change-email",to:"/registration",tabindex:"1"},{default:u(()=>[v("Change email")]),_:1})])]),body:u(()=>[b("div",fe,[(y(!0),oe(se,null,ne(r(o),($,m)=>(y(),A(H,{key:m,value:$,class:"opt-body__input",tabindex:m+2,autofocus:!m,onPast:h=>r(s)(h,m),onBeforeinput:h=>r(L)(h,m),onKeydown:h=>r(e)(h,m)},null,8,["value","tabindex","autofocus","onPast","onBeforeinput","onKeydown"]))),128))])]),button:u(()=>[w(P,{tabindex:r(n)+2,disabled:r(t)||r(I),onAction:T},{default:u(()=>[v("Submit")]),_:1},8,["tabindex","disabled"])]),_:1},8,["name","error"])]),_:1})}}}),we=R(me,[["__scopeId","data-v-e68491c6"]]);export{we as default};
